{
  "magic": "E!vIA5L86J2I",
  "timestamp": "2024-03-07T00:44:48.290643+00:00",
  "repo": "cfrg/draft-irtf-cfrg-det-sigs-with-noise",
  "labels": [
    {
      "name": "bug",
      "description": "Something isn't working",
      "color": "d73a4a"
    },
    {
      "name": "documentation",
      "description": "Improvements or additions to documentation",
      "color": "0075ca"
    },
    {
      "name": "duplicate",
      "description": "This issue or pull request already exists",
      "color": "cfd3d7"
    },
    {
      "name": "enhancement",
      "description": "New feature or request",
      "color": "a2eeef"
    },
    {
      "name": "good first issue",
      "description": "Good for newcomers",
      "color": "7057ff"
    },
    {
      "name": "help wanted",
      "description": "Extra attention is needed",
      "color": "008672"
    },
    {
      "name": "invalid",
      "description": "This doesn't seem right",
      "color": "e4e669"
    },
    {
      "name": "question",
      "description": "Further information is requested",
      "color": "d876e3"
    },
    {
      "name": "wontfix",
      "description": "This will not be worked on",
      "color": "ffffff"
    }
  ],
  "issues": [
    {
      "number": 1,
      "id": "I_kwDOIymWWc6ApNAK",
      "title": "For discussion section from draft",
      "url": "https://github.com/cfrg/draft-irtf-cfrg-det-sigs-with-noise/issues/1",
      "state": "CLOSED",
      "author": "emanjon",
      "authorAssociation": "COLLABORATOR",
      "assignees": [],
      "labels": [],
      "body": "- Ordering of the parameters in \"dom2(F, C) || Z || prefix || 000... || PH(M)\" in Ed25519 and similar in Ed448 and ECDSA. There has also been sugestion to use a larger Z and to use several paddings 000....\r\n\r\n- Ilari Liusvaara pointed out attacks using the context that needs to be considered. Some statements \"first block is composed only of the hashed private key and the random value\" in the document are not true for Ed25519ctx and Ed448ctx.\r\n\r\n- Jim Schaad: Is there any advantage to stealing one of the zeros from the end padding and using it to pad between 'Z' and 'x' in the construction? I would assume that it should use the '0'/'1' construction between steps d and f.\r\n\r\n- Jim Schaad: Is there any advantage to padding with 0x01 in step f rather than 0x00?\r\n\r\n- Rene Stuik: MUST instead of RECOMMENDED.",
      "createdAt": "2024-02-28T07:21:43Z",
      "updatedAt": "2024-02-28T12:39:53Z",
      "closedAt": "2024-02-28T12:39:53Z",
      "comments": [
        {
          "author": "emanjon",
          "authorAssociation": "COLLABORATOR",
          "body": "-use several paddings 000.... \r\n-pad between 'Z' and 'x'\r\n-statements are not true\r\n\r\nAre addressed in main. Closing this issue. If something needs further discussion we open a new more focused issue.",
          "createdAt": "2024-02-28T12:39:53Z",
          "updatedAt": "2024-02-28T12:39:53Z"
        }
      ]
    },
    {
      "number": 2,
      "id": "I_kwDOIymWWc6Ap0QG",
      "title": "Comments from Danny Niu - RNG use in ECDSA",
      "url": "https://github.com/cfrg/draft-irtf-cfrg-det-sigs-with-noise/issues/2",
      "state": "OPEN",
      "author": "emanjon",
      "authorAssociation": "COLLABORATOR",
      "assignees": [],
      "labels": [],
      "body": "I'd like to let the interested parties know that, I've written a experimental C implementation of the draft. If anyone's interested in benchmarking or any kind of testing, I'd love to assist. I've also raised a few implementation-related issue at [crypto.stackexchange.com/a/106599/36960](http://crypto.stackexchange.com/a/106599/36960) and I'll summarize here:\r\n\r\n1. The draft treats ECDSA RNG as a white box and penetrates the PRNG boundary to seed it, which is something NIST specifies not to do. This isn't too big an issue, as there are ways to maintain functionality opacity.\r\n\r\n2. The draft underspecifies how to use KMAC when the hash function is SHAKE. The way I prefer is to persuade NIST to specify and approve a permutation-based PRNG and use that instead. However in the interim time, we could add details on how KMAC should be used with HMAC-DRBG, but again, it'll penetrate the PRNG boundary. What's more, KMAC had not been approved for use with HMAC-DRBG yet.",
      "createdAt": "2024-02-28T08:59:13Z",
      "updatedAt": "2024-03-05T04:06:30Z",
      "closedAt": null,
      "comments": [
        {
          "author": "dannyniu",
          "authorAssociation": "NONE",
          "body": "Answering the email\r\n====\r\n\r\n> 1. I am correct in my understanding that this is concerning deterministic ECDSA (RFC 6979) and not just the hedged construction in draft-irtf-cfrg-det-sigs-with-noise?\r\n\r\nActually I directed my 1st comment directly at the new ECDSA hedged RNG construction. \r\n\r\nI'll have to **object** to the construction in the new https://www.ietf.org/archive/id/draft-irtf-cfrg-det-sigs-with-noise-02.html - It uses 2 different `Z` (`Zd` and `Zf`) which completely breaks PRNG boundary. I'll assume with best of my faith that this is an oversight caused by not being able to realize the rationales that I'll provide below.\r\n\r\nIf you look at [NIST.SP.800-90Ar1 Page 44 section 10.1.2.2](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf#page=53), there's only 1 single *provided_data* in the `HMAC_DRBG Update` process, and RFC-6979 was drafted in such way that PRNG behavior can be preserved. See [section 3.3 of RFC-6979](https://www.rfc-editor.org/rfc/rfc6979#section-3.3). So by changing the value(s) of `Z`, you're really changing an established CSPRNG algorithm!\r\n\r\nMy interpretation on this is that the \"deterministic\" ECDSA should be implementable by combining an existing signing implementation with an existing HMAC-DRBG implementation. If the new hedged ECDSA use 2 different `Z`s, then it will be impossible to combine them in such way.\r\n\r\n> 2. I don\u2019t see excactly what is missing for KMAC. Maybe you can describe in more detail in the GitHub issue?\r\n\r\nActually, there isn't much missing for KMAC, except we need to specify whether to *invoke* KMAC as a XOF (with L=0) or a fixed-length PRF (with L being 32, 48, <s>64</s> 66 (P-521)). \r\n\r\nThe other thing is just I hoped NIST can specify a DRBG based on Keccak-1600 so that something more efficient than KMAC can be adopted in the future.\r\n\r\nMore on PRNG boundary\r\n====\r\n\r\nI was recently amazed by [this StackExchange post](https://softwareengineering.stackexchange.com/q/452229/290091) which talks about \"tell, don't ask\" paradigm, which I think is nice. I think it's best to:\r\n\r\n- **tell** the PRNG we want to seed you with nonce, privkey, an H(msg), \r\n- **rather than asking** \"what's your block-length\", than doing seed nonce, pad, seed privkey, pad, seed H(msg).\r\n\r\nThe HMAC calls in step d and f are part of PRNG operation, and they shouldn't be exposed, not to mention altered. Querying the block size of the hash function is the most I consider reasonable in this circumstance.\r\n\r\n----\r\n\r\nExisting experience\r\n====\r\n\r\nMy parallel effort on [ML-DSA](https://github.com/dannyniu/MySuiteA/blob/b48deb7f9acc953f47eb9a10065b85355a2d011b/src/3-pq-crystals/mldsa.c#L371) and [SLH-DSA](https://github.com/dannyniu/MySuiteA/blob/b48deb7f9acc953f47eb9a10065b85355a2d011b/src/3-sphincs/slhdsa.c#L98) also shows that it's easiest when hedged generation of nonce is part of algorithm, and especially easy when it can switch seemlessly between hedged and deterministic.\r\n\r\nMy EdDSA was able to be modified in-place. However, my existing implementation for ECDSA (as well as the similar SM2 DSS from China - my homeland):\r\n\r\n1. didn't reserve a space for an instance of HMAC-DRBG\r\n2. was intended to be combined with an *external* PRNG from day-one of its design\r\n\r\nTherefore I implemented an external [`Signer`](https://github.com/dannyniu/MySuiteA/blob/c8b5537f4435759cac4bb6551d9a26aa7ee16f51/src/3-ecc-common/ecc-dss-sign-hedged.c). ",
          "createdAt": "2024-03-04T11:27:37Z",
          "updatedAt": "2024-03-05T04:06:30Z"
        }
      ]
    },
    {
      "number": 3,
      "id": "I_kwDOIymWWc6AqNBX",
      "title": "Suggestion from Bernstein - Allow switching order of Z and \"prefix\"",
      "url": "https://github.com/cfrg/draft-irtf-cfrg-det-sigs-with-noise/issues/3",
      "state": "OPEN",
      "author": "emanjon",
      "authorAssociation": "COLLABORATOR",
      "assignees": [],
      "labels": [],
      "body": "https://mailarchive.ietf.org/arch/msg/cfrg/GRigAYvZ8-Z8qmxJ1jOiKR8eLyQ/\r\n\r\n> Compute SHA-512(dom2(F, C) || Z || prefix || 000... || PH(M)),\r\n\r\nWhat stops implementors from forgetting to include PH(M) in the hash\r\ninput? I'd recommend building this on top of a deterministic interface\r\nwhere Z is an explicit input, and making sure to test that interface.\r\n\r\nAlso, two useful rules of thumb regarding input concatenations (for\r\nmotivating attacks see, e.g., Crypto 1995 Preneel--van Oorschot): 1.\r\nNever put a variable-length input anywhere but last. Previous positions\r\ncan have fixed-length _hashes_ of other variable-length inputs. 2. Put\r\nwhatever is least likely to be attacker-predictable first. Both Z and\r\n\"prefix\" are less likely to be attacker-predictable than C; scenarios\r\nwhere RNG failures are the top threat should put \"prefix\" first, while\r\nscenarios where side channels are the top threat (which seems to be the\r\nscenario under discussion) should put Z first.\r\n\r\n---D. J. Bernstein",
      "createdAt": "2024-02-28T09:51:26Z",
      "updatedAt": "2024-02-28T11:17:49Z",
      "closedAt": null,
      "comments": []
    },
    {
      "number": 4,
      "id": "I_kwDOIymWWc6Avdkp",
      "title": "Request from Taylor R Campbell - Test vectors inclusing Z",
      "url": "https://github.com/cfrg/draft-irtf-cfrg-det-sigs-with-noise/issues/4",
      "state": "OPEN",
      "author": "emanjon",
      "authorAssociation": "COLLABORATOR",
      "assignees": [],
      "labels": [],
      "body": "Where does one find test vectors for the deterministic functions\r\ndefined here with the extra randomization parameters Z?\r\n\r\nhttps://mailarchive.ietf.org/arch/msg/cfrg/jmfn1b880x7-7gZKb7_uwLvE3oU/",
      "createdAt": "2024-02-28T21:48:17Z",
      "updatedAt": "2024-02-28T21:48:18Z",
      "closedAt": null,
      "comments": []
    },
    {
      "number": 5,
      "id": "I_kwDOIymWWc6Avd5e",
      "title": "Suggestion from Taylor R Campbell - Don't use Z twice",
      "url": "https://github.com/cfrg/draft-irtf-cfrg-det-sigs-with-noise/issues/5",
      "state": "CLOSED",
      "author": "emanjon",
      "authorAssociation": "COLLABORATOR",
      "assignees": [],
      "labels": [],
      "body": ">    *  Added note that Z in step f is not reused from step d.\r\n\r\nMay I suggest using different letters for this, or numbered instances\r\nlike Z0 and Z1?  It's confusing to define a function F(m, Z, Z) as\r\nyou're doing here where the two Z's are actually different parameters.\r\n\r\n\r\nhttps://mailarchive.ietf.org/arch/msg/cfrg/jmfn1b880x7-7gZKb7_uwLvE3oU/",
      "createdAt": "2024-02-28T21:49:19Z",
      "updatedAt": "2024-03-05T11:15:31Z",
      "closedAt": "2024-02-29T09:26:47Z",
      "comments": [
        {
          "author": "emanjon",
          "authorAssociation": "COLLABORATOR",
          "body": "Fixed in main",
          "createdAt": "2024-02-29T09:26:47Z",
          "updatedAt": "2024-02-29T09:26:47Z"
        },
        {
          "author": "dannyniu",
          "authorAssociation": "NONE",
          "body": "Using different `Z` for steps d and f breaks PRNG boundary - RFC-6979 is essentially ECDSA plus a user-seeded HMAC-DRBG, using different `Z`s changes **and breaks** the PRNG algorithm. See [Issue 2](https://github.com/cfrg/draft-irtf-cfrg-det-sigs-with-noise/issues/2)",
          "createdAt": "2024-03-05T11:14:50Z",
          "updatedAt": "2024-03-05T11:15:31Z"
        }
      ]
    }
  ],
  "pulls": []
}